{% extends 'side_bar.html' %}
{% load extras %}
{% block title %}Login{% endblock %}

{% block htmlbody %}

<!--app-content open-->
				<div class="app-content main-content mt-0">
					<div class="side-app">
						<!-- CONTAINER -->
						<div class="main-container container-fluid">

							<!-- PAGE-HEADER -->
							<div class="page-header">
								<div>
									<h1 class="page-title">Manage Data Central</h1>
								</div>
								<div class="ms-auto pageheader-btn">
									<ol class="breadcrumb">
										<li class="breadcrumb-item"><a href="javascript:void(0);">Manage Data Central</a></li>
										<li class="breadcrumb-item active" aria-current="page">Data Central List</li>
									</ol>
								</div>
							</div>
							<!-- PAGE-HEADER END -->
							<!-- Row -->
							<div class="row row-sm">
								<div class="col-lg-12">
									<div class="card">
										{% if messages %}
											{% for message in messages %}
											<div class="container-fluid p-0">
											  <div class="alert {{ message.tags }} alert-dismissible" role="alert" >
												<button type="button" class="close" data-bs-dismiss="alert" aria-label="Close">
												  <span aria-hidden="True">&times;</span>
												</button>
												{{ message }}
											  </div>
											</div>
											{% endfor %}
										{% endif %}
										<div class="card-body">
										<form method="get" class="row g-3 mb-4">
											<div class="col-md-4">
												<select name="year" class="form-control">
													<option value="">-- All Years --</option>
													{% for y in years %}
														<option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
													{% endfor %}
												</select>
											</div>
											<div class="col-md-4">
												<button type="submit" class="btn btn-primary me-2">Filter</button>
												<a href="{% url 'app:missing_email_authors' %}" class="btn btn-secondary">Reset</a>
											</div>
										</form>
											<div class="mb-3">
        <a href="?{% if selected_year %}year={{ selected_year }}&{% endif %}export=csv" class="btn btn-outline-info me-2">ðŸ“„ Export CSV</a>
        <a href="?{% if selected_year %}year={{ selected_year }}&{% endif %}export=excel" class="btn btn-outline-success">ðŸ“Š Export Excel</a>
    </div>
										</div>
										<div class="card-header border-bottom">
											<h3 class="card-title">Data Central List</h3>
											<div class="ms-auto pageheader-btn">
											</div>
										</div>
										<div class="card-body">
											<p><strong>Total Records:</strong> {{ total_count }}</p>
											<!-- Table -->
										<table class="table table-bordered">
											<thead>
												<tr>
													<th>#</th>
													<th>Author Name</th>
													<th>Affiliation</th>
													<th>Article Title</th>
													<th>Year</th>
												</tr>
											</thead>
											<tbody>
												{% for row in page_obj.object_list %}
													<tr>
														<td>{{ forloop.counter0|add:page_obj.start_index }}</td>
														<td>{{ row.author_name }}</td>
														<td>{{ row.affiliation }}</td>
														<td>{{ row.article_title }}</td>
														<td>{{ row.year }}</td>
													</tr>
												{% empty %}
													<tr><td colspan="5" class="text-center">No missing emails found.</td></tr>
												{% endfor %}
											</tbody>
										</table>

										<!-- Pagination -->
										<nav>
											<ul class="pagination">
												{% if page_obj.has_previous %}
													<li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&year={{ selected_year }}">Previous</a></li>
												{% else %}
													<li class="page-item disabled"><span class="page-link">Previous</span></li>
												{% endif %}

												{% for num in page_obj.paginator.page_range %}
													{% if page_obj.number == num %}
														<li class="page-item active"><span class="page-link">{{ num }}</span></li>
													{% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
														<li class="page-item"><a class="page-link" href="?page={{ num }}&year={{ selected_year }}">{{ num }}</a></li>
													{% endif %}
												{% endfor %}

												{% if page_obj.has_next %}
													<li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&year={{ selected_year }}">Next</a></li>
												{% else %}
													<li class="page-item disabled"><span class="page-link">Next</span></li>
												{% endif %}
											</ul>
										</nav>
										</div>
									</div>
								</div>
							</div>
							<!-- End Row -->
                      </div>
					</div>
				</div>
				<!-- CONTAINER CLOSED -->


{% endblock %}